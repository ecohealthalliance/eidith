<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PREDICT-2 Multiple Response Fields • EIDITH</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="PREDICT-2 Multiple Response Fields">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eidith</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/eidith.html">Installation / Authentication / Downloading Database</a>
    </li>
    <li>
      <a href="../articles/preprocessing.html">Automatic Data Processing / Raw Data</a>
    </li>
    <li>
      <a href="../articles/data_structure.html">PREDICT-1 Database Structure / Table Joining</a>
    </li>
    <li>
      <a href="../articles/fasta_walkthrough.html">PREDICT-1 Generating Reports and FASTA</a>
    </li>
    <li>
      <a href="../articles/eidith_API.html">PREDICT-1 Web API Details</a>
    </li>
    <li>
      <a href="../articles/p2_data_structure.html">PREDICT-2 Database Structure / Table Joining</a>
    </li>
    <li>
      <a href="../articles/multi_response_fields.html">PREDICT-2 Multiple Response Fields</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Release Notes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ecohealthalliance/eidith">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>PREDICT-2 Multiple Response Fields</h1>
                        <h4 class="author">Cale Basaraba</h4>
            
      
      <small>Source: <a href="https://github.com/ecohealthalliance/eidith/blob/master/vignettes/multi_response_fields.rmd"><code>vignettes/multi_response_fields.rmd</code></a></small>
      <div class="hidden name"><code>multi_response_fields.rmd</code></div>

    </div>

    
    
<div id="setup" class="section level3">
<h3 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h3>
<p>Before exploring the tables in the EIDITH database using the eidith package, make sure to load it and some other libraries we’re going to need:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(eidith)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(dplyr)</code></pre></div>
</div>
<div id="multiple-response-fields" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-response-fields" class="anchor"></a>Multiple Response Fields</h3>
<p>There are many fields in the PREDICT-2 EIDITH database that contain information from multiple-response questions. These fields are represented in the database by semicolon-separated strings like <code>"rodents; primates; bats"</code> or <code>"for food; for sale; other"</code>. If you are interested in analyzing or visualizing the data from these fields, it can be hard to wrangle these semicolon-separated strings into correctly formatted variables.</p>
<p>Since this is an issue that comes up often in the PREDICT-2 EIDITH data, we have made functions to help users transform semicolon-separated variables into long format (most convenient for <code>ggplot2</code> graphing) and wide format (used for some types of analysis).</p>
</div>
<div id="wide-transformation-ed2_expand_wide" class="section level3">
<h3 class="hasAnchor">
<a href="#wide-transformation-ed2_expand_wide" class="anchor"></a>Wide Transformation: <code><a href="../reference/ed2_expand_wide.html">ed2_expand_wide()</a></code>
</h3>
<p>Let’s first look at transforming a semicolon-separated field into wide form. We can use the Human Questionnaire data as an example, looking specifically at the <code>travel_reason</code> field, which contains data from Question 38: <em>Why have you traveled? Select all that apply</em></p>
<p>We can load this data into our session and then reduce it to just two variables to take an easier look at the process:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">humans &lt;-<span class="st"> </span><span class="kw">ed2_human</span>()

humans_reduced &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(humans, participant_id, travel_reason)</code></pre></div>
<p>We can take a look at the <code>head</code> of this data to get an idea for how the <code>travel_reason</code> field looks. We can use <code><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable()</a></code> from the <code>knitr</code> package to get a cleaner looking output:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(humans_reduced) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">participant_id</th>
<th align="left">travel_reason</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BDAH0175</td>
<td align="left">holiday/vacation</td>
</tr>
<tr class="even">
<td align="left">BDAH0176</td>
<td align="left">visit family</td>
</tr>
<tr class="odd">
<td align="left">BDAH0177</td>
<td align="left">work ; visit family</td>
</tr>
<tr class="even">
<td align="left">BDAH0178</td>
<td align="left">visit family; holiday/vacation</td>
</tr>
<tr class="odd">
<td align="left">BDAH0179</td>
<td align="left">work</td>
</tr>
<tr class="even">
<td align="left">BDAH0180</td>
<td align="left">visit family</td>
</tr>
</tbody>
</table>
<p>As you can see, some participants list only one <code>travel_reason</code>, while others list multiple reasons that are separated by semicolons.</p>
<p>We can use the <code><a href="../reference/ed2_expand_wide.html">ed2_expand_wide()</a></code> function to expand these fields so that each <code>travel_reason</code> response is a separate variable, and whether a partipant has listed it in their response becomes a TRUE / FALSE value for that variable.</p>
<p>The first argument of the <code><a href="../reference/ed2_expand_wide.html">ed2_expand_wide()</a></code> function takes the input dataframe we are going to transform (<code>humans_reduced</code> in our case), and the second argument indicates the column we wish to expand (<code>travel_reason</code>). There is an optional third argument <code>clean_names</code> which allows the user to toggle on or off the cleaning up of variable names after expansion; as a default, variable name cleaning will occur.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">humans_reduced_wide &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ed2_expand_wide.html">ed2_expand_wide</a></span>(humans_reduced, travel_reason)

<span class="kw">head</span>(humans_reduced_wide) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">participant_id</th>
<th align="left">travel_reason</th>
<th align="left">travel_reason_go_to_hospital_seek_medical_care</th>
<th align="left">travel_reason_go_to_market</th>
<th align="left">travel_reason_holiday_vacation</th>
<th align="left">travel_reason_moved</th>
<th align="left">travel_reason_n_a</th>
<th align="left">travel_reason_other</th>
<th align="left">travel_reason_religious_reasons</th>
<th align="left">travel_reason_visit_family</th>
<th align="left">travel_reason_work</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BDAH0001</td>
<td align="left">visit family</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">BDAH0002</td>
<td align="left">visit family</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">BDAH0003</td>
<td align="left">visit family</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">BDAH0004</td>
<td align="left">visit family</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">BDAH0005</td>
<td align="left">visit family</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">BDAH0006</td>
<td align="left">visit family; holiday/vacation</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>Taking a look at the new <code>humans_reduced_wide</code> dataframe, we see that each row contains an individual participant identified by their <code>participant_id</code>, but their responses to the <code>travel_reason</code> question have been expanded into individual variables.</p>
<p>Notice that every participant response that was coded as “other” has been grouped together into one TRUE / FALSE variable. This is because many “other” entries in the PREDICT-2 EIDITH database contain additional information written in as free text – treating each one of these as a variable quickly becomes unmanageable.</p>
<p>This data format is necessary for certain types of analysis, and since each row represents a single participant, you can quickly do some visualizations (like a quick bar graph) for one TRUE / FALSE variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> humans_reduced_wide) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> travel_reason_go_to_market, <span class="dt">fill =</span> travel_reason_go_to_market), <span class="dt">width =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Reason for Travel Participant Responses: Going to Market"</span>)</code></pre></div>
<p><img src="multi_response_fields_files/figure-html/widegraph-1.png" width="864"></p>
<p>Single variables can be visualized in wide data format, but for most graphing applications data in long form is the way to go. Next, we’ll take a look at transforming multiple-response fields into a long data format</p>
</div>
<div id="long-transformation-ed2_expand_long" class="section level3">
<h3 class="hasAnchor">
<a href="#long-transformation-ed2_expand_long" class="anchor"></a>Long Transformation: <code><a href="../reference/ed2_expand_long.html">ed2_expand_long()</a></code>
</h3>
<p>This time we are going to expand the <code>travel_reason</code> variable in the <code>humans_reduced</code> dataset into long form using the <code><a href="../reference/ed2_expand_long.html">ed2_expand_long()</a></code> function. Now each row of the dataframe will represent one response to the survey question, instead of one participant. This data format can be very useful for visualizing data using the <code>ggplot2</code> package and may be necessary for certain types of analyses.</p>
<p>The first argument of the <code><a href="../reference/ed2_expand_long.html">ed2_expand_long()</a></code> function takes the input dataframe we are going to transform (<code>humans_reduced</code> in our case), and the second argument indicates the column we wish to expand (<code>travel_reason</code>). There is an optional third argument <code>other_details</code> that determines how we deal with “other” responses to a question, which we’ll talk about more later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">humans_reduced_long &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ed2_expand_long.html">ed2_expand_long</a></span>(humans_reduced, travel_reason)

<span class="kw">head</span>(humans_reduced_long) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">participant_id</th>
<th align="left">travel_reason</th>
<th align="left">travel_reason_val</th>
<th align="left">other_details</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BDAH0175</td>
<td align="left">holiday/vacation</td>
<td align="left">holiday/vacation</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">BDAH0176</td>
<td align="left">visit family</td>
<td align="left">visit family</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">BDAH0177</td>
<td align="left">work ; visit family</td>
<td align="left">work</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">BDAH0177</td>
<td align="left">work ; visit family</td>
<td align="left">visit family</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">BDAH0178</td>
<td align="left">visit family; holiday/vacation</td>
<td align="left">visit family</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">BDAH0178</td>
<td align="left">visit family; holiday/vacation</td>
<td align="left">holiday/vacation</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>If we take a look at this long form dataframe (either using <code>head(humans_reduced_long)</code> or <code>View(humans_reduced_long)</code>, we can see that each row now represents one response value. As a result participants (identified by their <code>participant_id</code>) who have multiple response values are spread across multiple rows.</p>
<p>For many multiple-response fields, there is an option to write in an “other” value. As a result, one of the multiple responses will often be an “other” followed by free text with further explanation. Since most analyses or visualizations will want to group all other values together, the <code><a href="../reference/ed2_expand_long.html">ed2_expand_long()</a></code> function does this automatically. The function argument <code>other_details</code> determines whether the additional <code>other_details</code> variable is included which will preserve the free-text from the “other” entry, and is set to TRUE by default. The <code>other_details</code> field will be <code>NA</code> for all non-other categories.</p>
<p>We can take a look at the set of non-NA <code>other_details</code> data using the <code><a href="http://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">humans_other &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(humans_reduced_long, <span class="op">!</span><span class="kw">is.na</span>(other_details))

<span class="kw">head</span>(humans_other) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">participant_id</th>
<th align="left">travel_reason</th>
<th align="left">travel_reason_val</th>
<th align="left">other_details</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BDAH0030</td>
<td align="left">other-Education</td>
<td align="left">other</td>
<td align="left">Education</td>
</tr>
<tr class="even">
<td align="left">CISKBD0013</td>
<td align="left">visit family; other-tourism</td>
<td align="left">other</td>
<td align="left">tourism</td>
</tr>
<tr class="odd">
<td align="left">CNAH0007</td>
<td align="left">other-visit friends or government for things</td>
<td align="left">other</td>
<td align="left">visit friends or government for things</td>
</tr>
<tr class="even">
<td align="left">CNAH0010</td>
<td align="left">other-Visit friends</td>
<td align="left">other</td>
<td align="left">Visit friends</td>
</tr>
<tr class="odd">
<td align="left">CNAH0038</td>
<td align="left">visit family; go to market; other-Visit friends, shopping</td>
<td align="left">other</td>
<td align="left">Visit friends, shopping</td>
</tr>
<tr class="even">
<td align="left">CNAH0066</td>
<td align="left">go to hospital/seek medical care; other-Send children to school</td>
<td align="left">other</td>
<td align="left">Send children to school</td>
</tr>
</tbody>
</table>
<p>Looking at this subset of data, we can see that the freely entered “other” text has been preserved in the <code>other_details</code> field. If we set the <code>other_details</code> option to FALSE in the <code><a href="../reference/ed2_expand_long.html">ed2_expand_long()</a></code> function call, we will not have this additional column.</p>
<p>Data in long form is very easy to graph using <code>ggplot2</code>. In this example, we will make a bar graph that displays the responses to our travel question. Note the high number of “N/A” entries (for participants who did not travelat all).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> humans_reduced_long) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> travel_reason_val)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>,<span class="dt">hjust=</span><span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># this line of code turns the x-axis labels so they are easier to read</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Reason for Travel Participant Responses"</span>)</code></pre></div>
<p><img src="multi_response_fields_files/figure-html/longplot-1.png" width="672"></p>
</div>
<div id="conclusion" class="section level3">
<h3 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h3>
<p>This vignette describes the built-in helper functions <code><a href="../reference/ed2_expand_wide.html">ed2_expand_wide()</a></code> and <code><a href="../reference/ed2_expand_long.html">ed2_expand_long()</a></code> which allow users to break up semicolon-separated multiple-response variables into wide and long data formats. These are examples of helper functions which were developed to help users perform common actions. If you have an idea about a useful helper function, please check out the <a href="https://github.com/ecohealthalliance/eidith/issues">EIDITH R Package Issues page on Github</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Noam Ross, Nistara Randhawa, Cale Basaraba.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
