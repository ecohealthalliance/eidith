<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Structure / Table Joining • EIDITH</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">EIDITH</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/eidith.html">Installation / Authentication / Downloading Database</a>
    </li>
    <li>
      <a href="../articles/preprocessing.html">Automatic Data Processing / Raw Data</a>
    </li>
    <li>
      <a href="../articles/data_structure.html">Database Structure / Table Joining</a>
    </li>
    <li>
      <a href="../articles/fasta_walkthrough.html">Generating Reports and FASTA</a>
    </li>
    <li>
      <a href="../articles/eidith_API.html">Web API Details</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Release Notes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ecohealthalliance/eidith">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Data Structure / Table Joining</h1>
                        <h4 class="author">Cale Basaraba</h4>
            
          </div>

    
    
<div class="contents">
<div id="setup" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#setup" class="anchor"> </a></body></html>Setup</h3>
<p>Before exploring the tables in the EIDITH database using the eidith package, make sure to load it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(eidith)</code></pre></div>
<p>For the purposes of this vignette, you also will want to download / use the tidyverse package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"tidyverse"</span>)  
<span class="kw">library</span>(tidyverse)</code></pre></div>
<p>If you are having trouble installing the eidith R package, logon credentials, permissions, or have not downloaded the local database, please follow the instructions in the <a href="https://ecohealthalliance.github.io/eidith/articles/eidith.html">package setup tutorial</a>.</p>
</div>
<div id="eidith-database-structure" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#eidith-database-structure" class="anchor"> </a></body></html>EIDITH Database Structure</h3>
<p>Like many databases, EIDITH is divided into several tables that are linked by unique ID fields (integers in this case). Below is a sketch of the six EIDITH tables and their basic linking structure. The lines connecting tables identify the fields, or columns, that link one table to the next. The fields with yellow keys next to their names are unique IDs – this means that no two rows in that table can have the same value for this field.</p>
<p><img src="/Users/Basaraba/R/eidith/inst/images/tables.png" width="825px"></p>
<p>In the <code>events</code> table, for instance, each event (or row) has a unique <code>event_id</code>, while in the <code>animals</code> table, each animal (or row) has a unique <code>animal_id</code>. Importantly, each animal in the <code>animals</code> table also has an <code>event_id</code>, which links it to an event. Since <code>event_id</code> is not unique in the <code>animals</code> table, there can be more than one animal entry with the same <code>event_id</code> – this makes perfect sense, since there are likely multiple animals attached to a particular event. Using the <code><a href="../reference/ed_tables_conn.html">ed_tables_conn()</a></code> function at any time will display a table listing the ID fields linking tables together:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/ed_tables_conn.html">ed_tables_conn</a></span>()</code></pre></div>
<pre><code>##         T1               T2        conn
## 1    Event           Animal    event_id
## 2   Animal         Specimen   animal_id
## 3 Specimen TestIDSpecimenID specimen_id
## 4     Test            Virus     test_id
## 5     Test TestIDSpecimenID     test_id
## 6    Virus TestIDSpecimenID     test_id</code></pre>
<p>These ID fields tie all of the tables together, allowing us to join tables together that contain information we are interested in analyzing. EIDITH is a large database with many fields per table, so it can be challenging at first to determine which table contains the relevant information. Generally, the location of the information we are looking for should be in the table that it is most closely tied to: if we are looking for the species of an animal, that field should be in the <code>animals</code> table, if we are looking for the genetic sequence of a virus, that information should be in the <code>viruses</code> table. If we are having a hard time finding the field we need, we can use the <code><a href="../reference/ed_metadata.html">?ed_metadata</a></code> command to load the built-in help file that contains a searchable list of all EIDITH fields.</p>
<div id="testspecimens-table" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#testspecimens-table" class="anchor"> </a></body></html>Testspecimens Table</h4>
<p>The <code>testspecimens</code> table is different from the other five EIDITH tables: it is a lookup table whose only purpose is to allow the joining of the <code>tests</code> and <code>specimens</code> tables. It is necessary because one specimen can be linked to multiple tests and (due to pooled tests) one test can be linked to multiple specimens.</p>
</div>
</div>
<div id="joining-tables" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#joining-tables" class="anchor"> </a></body></html>Joining Tables</h3>
<p>Let’s walk through an example of joining tables in order to get information about the specimens taken during different events. Specifically, we will examine different specimen types by habitat Looking at the database structure diagram above, we will need the <code>events</code>, <code>animals</code>, and <code>specimens</code> tables to link together information about events (habitat) with information about specimens (speciment type). Notice we cannot link rows in the <code>specimens</code> table directly to the <code>events</code> table. This is because the <code>specimens</code> table contains information about which animal the specimen was obtained from, but only the <code>animals</code> table has information about which animal is connected to a particular event.</p>
<p>First, we need to load these three tables from our locally stored EIDITH database into R. If you have EIDITH database access, you can use the functions <code><a href="../reference/ed_table_.html">ed_events()</a></code>, <code><a href="../reference/ed_table_.html">ed_animals()</a></code> and <code><a href="../reference/ed_table_.html">ed_specimens()</a></code> to access your data, but for the purposes of this vignette we will use the mock data available using the <code>ed_mock</code> calls. For more information on the mock data included in the package, <code><a href="../reference/ed_table_mock_.html">?ed_mock</a></code> will open a helpfile in RStudio.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mock_events &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ed_table_mock_.html">ed_events_mock</a></span>()
mock_animals &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ed_table_mock_.html">ed_animals_mock</a></span>()
mock_specimens &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ed_table_mock_.html">ed_specimens_mock</a></span>()</code></pre></div>
<p>We can take a look at all the fields / columns in these tables by running <code>names(mock_events)</code>, <code>names(mock_animals)</code>, or <code>names(mock_specimens)</code> which will print out all the column names from these tables into our console. If we do this, we can see that, along with many other fields, each table has the ID fields highlighted in the database structure diagram above.</p>
<p>We will have to perform two joins in this example. First, we will join the <code>mock_events</code> table to the <code>mock_animals</code> table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mock_ea &lt;-<span class="st"> </span><span class="kw">inner_join</span>(mock_events, mock_animals, <span class="dt">by =</span> <span class="st">"event_id"</span>)</code></pre></div>
<p>In this example we used the <code>inner_join()</code> function from the <code>dplyr</code> package. Note that we use the <code>by = "event_id"</code> argument to specify that we want to join based on the linking key. This type of join will combine all columns from both tables, but will drop entries from the <code>events</code> table that have no linked entries in the <code>animals</code> table and vice versa. Depending on what kind of analysis we are interested in, we may want to perform a different kind of join. Running <code>?dplyr::join</code> to read the <code>dplyr</code> join help file explains different joining options.</p>
<p>If we run <code>names(mock_ea)</code> we can see that we now have a dataframe with all the columns from both the <code>mock_events</code> and <code>mock_animals</code> tables. Our next step is to join this table to the <code>mock_specimens</code> table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mock_eas &lt;-<span class="st"> </span><span class="kw">inner_join</span>(mock_ea, mock_specimens, <span class="dt">by =</span> <span class="st">"animal_id"</span>)</code></pre></div>
<p>We now have a table that combines information from all three tables, and can create a visualization of specimen type by habitat type. We can use the <code>ggplot2</code> package to create a clean stacked-bar graph. We can install and load the <code>ggplot2</code> package using the code below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"ggplot2"</span>)
<span class="kw">library</span>(ggplot2)</code></pre></div>
<p>The following code creates a stacked-bar graph using the <code>ggplot2</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mock_eas) +<span class="st">       </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> specimen_type_id, <span class="dt">fill =</span> habitat_type)) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>), <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="st">""</span>)) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Specimen Type by Habitat Type (Mock Data)"</span>, <span class="dt">x =</span> <span class="st">"Specimen Type"</span>, <span class="dt">y =</span> <span class="st">"Count (specimens)"</span>, <span class="dt">fill =</span> <span class="st">"Habitat Type"</span>)</code></pre></div>
<p><img src="data_structure_files/figure-html/7-1.png" width="672"></p>
</div>
<div id="conclusion" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#conclusion" class="anchor"> </a></body></html>Conclusion</h3>
<p>This vignette describes the data structure of the EIDITH database and leads the user through some simple joins to link information from the <code>events</code> and <code>specimens</code> tables. The same process can be done to visualize or analyze information from across any of the tables in EIDITH database.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Noam Ross, Nistara Randhawa, Cale Basaraba.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
